<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Compressor Presets</title>
    <link rel="manifest" href="./manifest.json" />
    <link rel="stylesheet" href="./styles.css" />
    <!-- Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Sora:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <meta name="theme-color" content="#0b0e13" />
  </head>
  <body>
    <header class="hero">
      <h1 class="hero-title">
        Video Compressor
        <span class="underline">Presets</span>
      </h1>
      <p class="hero-subtitle">
        Compress &amp; resize videos instantly. Privacy-first. In your browser.
      </p>
      <div class="hero-actions">
        <input type="file" id="fileInput" accept="video/*" hidden />
        <button type="button" class="btn btn-primary" id="chooseFileBtn">
          Choose video
        </button>
        <!-- New: appears after a file is chosen -->
        <button type="button" class="btn btn-primary" id="compressBtn" style="display:none">
          Compress
        </button>
        <span class="hint" id="fileHint">Drag &amp; drop or choose a file</span>
      </div>
    </header>

    <main id="mainContent">
      <section id="presetSection" class="presets-section">
        <h2 class="section-title">Choose a preset</h2>
        <p class="section-tip">
          Tip: Choose <strong>Chat/Email</strong> when file size matters,
          or <strong>Vertical/Landscape</strong> when you need a social-friendly format.
        </p>

        <div id="topPresets" class="preset-grid top-presets"></div>
        <div id="otherPresets" class="preset-grid"></div>
      </section>

      <section id="customSection" class="custom-section">
        <h2 class="section-title">Custom builder</h2>
        <div id="customPanel" class="custom-panel"></div>

        <!-- Clean lock card when Custom is Pro-only -->
        <div id="customLock" class="lock-overlay hidden" role="note" aria-live="polite">
          <div class="lock-row">
            <svg class="icon-lock" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor"
                d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 8V6a3 3 0 016 0v3H9zm3 4a2 2 0 110 4 2 2 0 010-4z"/>
            </svg>
            <span>Custom builder is a Pro feature.</span>
            <button type="button" class="btn btn-secondary btn-ghost" id="learnMorePro">Learn more</button>
          </div>
          <div class="lock-fine">Set aspect/fit, max height, FPS, size target/CRF, and audio bitrate.</div>
        </div>
      </section>

      <section id="progressSection" class="progress-section hidden">
        <div class="progress-bar-container" aria-hidden="false">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <p id="progressLabel" class="progress-label" aria-live="polite"></p>
      </section>

      <section id="resultSection" class="result-section hidden">
        <h2 class="section-title">Result</h2>
        <video id="resultVideo" controls class="result-video"></video>
        <div class="result-actions">
          <a id="downloadLink" class="btn btn-secondary" download>Download</a>
          <button id="shareBtn" class="btn btn-secondary">Share</button>
        </div>
        <p id="nagMessage" class="nag-message"></p>
      </section>
    </main>

    <footer class="footer">
      <p class="footnote">
        Privacy-first · Works in your browser · PWA
      </p>
    </footer>

    <!-- Small toast -->
    <div id="proToast" class="toast hidden" role="status" aria-live="polite">
      <svg class="toast-icon" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor"
          d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 8V6a3 3 0 016 0v3H9zm3 4a2 2 0 110 4 2 2 0 010-4z"/>
      </svg>
      <div class="toast-text">
        <strong>Pro feature</strong>
        <span id="proToastMsg"> This feature is available in Pro. </span>
      </div>
      <button class="toast-close" aria-label="Close" onclick="hideProToast()">×</button>
    </div>

    <!-- Learn more modal -->
    <dialog id="learnModal" class="modal">
      <form method="dialog" class="modal-card">
        <div class="modal-header">
          <h3>How the Custom builder works</h3>
          <button type="button" class="modal-close" aria-label="Close" onclick="closeLearnModal()">×</button>
        </div>

        <div class="modal-body">
          <ol class="modal-steps">
            <li>Choose <strong>Aspect</strong> (or keep source) and <strong>Fit</strong> (cover/contain).</li>
            <li>Set <strong>Max height</strong> (px) and optionally <strong>FPS</strong>.</li>
            <li>Pick <strong>Mode</strong>:
              <ul>
                <li><strong>Size</strong> → enter <em>Target size (MB)</em>.</li>
                <li><strong>Quality</strong> → enter <em>CRF</em> (lower = better; 18–28 is typical).</li>
              </ul>
            </li>
            <li>Set <strong>Audio bitrate</strong> (kbps), then click <strong>Compress</strong>.</li>
          </ol>

          <div class="modal-fields">
            <div><strong>Aspect</strong> — keep, 16:9, 9:16, 1:1, 4:5</div>
            <div><strong>Fit</strong> — cover (crop) / contain (pad)</div>
            <div><strong>Max height</strong> — target height in px</div>
            <div><strong>FPS</strong> — e.g. 24/30/60</div>
            <div><strong>Mode</strong> — Size or Quality</div>
            <div><strong>Target size</strong> — for Size mode (MB)</div>
            <div><strong>CRF</strong> — for Quality mode (lower = better)</div>
            <div><strong>Audio</strong> — 96–160 kbps is fine for speech</div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" value="close" onclick="closeLearnModal()">Close</button>
        </div>
      </form>
    </dialog>

    <script type="module" src="./app.js"></script>
  </body>
</html>
